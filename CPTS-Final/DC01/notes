┌──(usr㉿TheThird)-[~/Desktop/HTB/CPTS-Final/ligolo-ng]
└─$ sudo nmap -sCV 172.16.139.3                             
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-16 09:19 EDT
Nmap scan report for 172.16.139.3
Host is up (0.76s latency).
Not shown: 989 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-04-16 13:19:31Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: trilocor.local0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: trilocor.local0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
|_nbstat: NetBIOS name: DC01, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:b9:4b:a2 (VMware)
| smb2-time: 
|   date: 2024-04-16T13:19:34
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 24.40 seconds


using pthorpe creds to enumerate the SMB share
found creds in Department Shares\IT\Public\Windows 10\CreateLocalAdminAcc.ps1
# Configuration
$username = "adminTest"   # Administrator is built-in name
$password = ConvertTo-SecureString "LazyAdminPwd123!" -AsPlainText -Force  # Super strong plane text password here (yes this isn't secure at all)
$logFile = "\\server\folder\log.txt"

uploaded malicious link file to Printer_jobs while running Inveigh on MS01 to obtain NTLMv2 hashes
obtained hashes for
bmarley
gmarley
and jflemming
jflemming is part of the helpdesk user group and has GenericWrite privileges over another user
ksalinas

used these rights to set fake SPN
Kerberoasted ksalinas
ksalinas had some rights to do stuff
then more stuff
then even more stuff

this allowed for esscalated access to the SMB share, including a private folder in IT
this contained a backup file
downloaded backup file and cracked a hash in hashcat
moved the backup file to WS01 and used the VeraCrypt installed there to mount the backup
this contained another backup file tilocor_svc_vault.psafe3
stole this and cracked with john
thevault!        (trilocor_svc_vault)
